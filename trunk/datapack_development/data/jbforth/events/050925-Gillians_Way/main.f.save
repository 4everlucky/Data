\ 2005-09-25, (c)Balancer, (c)Tais
\ Event "Gillian’s Way"

3 value event:step

\ ========= Begin of main code ============

: step? event:step > if rdrop exit then ;
: stept 1 event:step dup . > . ;
: run! 1 to event:step ;

: stop
	ride-hair-enable
	0 to event:step
;

\ used by timer
: event_ends  ( -- )  
    step?
	stop
;

: npc-7017-dialog-append 
    1 step?
	'<br><a action="bypass -h jbf_event_050925_GW_7017">Event "Gillian’s Way"</a><br>' .
;

: ustep@   "event:Gillian’s Way:step" uv-load ;
: ustep!   "event:Gillian’s Way:step" uv-save ;
: ustep?   ustep@ < if rdrop exit then ;

: bypass_event_050925_GW_7017
    1 step?
	player@ mage? if
		4296 player@ inventory? 0 > if
			"You already Knight of Orden" show
		else
			"jbforth/events/050925-Gillians_Way/7017.htm" show
		then
	else
		"Excuse, I talk only with magicians" show
	then
		
;

: bypass_event_050925_GW_7017-2
	1 step?
	1 4296 ( Order ) item_add
	'ItemSound.quest_fanfare_2' so
	"jbforth/events/050925-Gillians_Way/7017-2.htm" show
;

: npc-7008-dialog-append 
    1 step?
	'<br><a action="bypass -h jbf_event_050925_GW_7008">Event "Gillian’s Way"</a><br>' .
;

: bypass_event_050925_GW_7008
    1 step?
	player@ mage? if
		"Excuse, I talk only with warriors" show
	else
		4296 player@ inventory? 0 > if
			"You already Knight of Orden" show
		else
			"jbforth/events/050925-Gillians_Way/7008.htm" show
		then
	then
;

: bypass_event_050925_GW_7008-2
	1 step?
	1 4296 ( Order ) item_add
	'ItemSound.quest_fanfare_2' so
	"jbforth/events/050925-Gillians_Way/7008-2.htm" show
;

: npc-7343-dialog-append 
    1 step?
	'<br><a action="bypass -h jbf_event_050925_GW_7343">Event "Gillian’s Way"</a><br>' .
;

: bypass_event_050925_GW_7343
    1 step?
	4296 player@ inventory? 1 < if
		"Sorry, i don't know you" show
		exit
	then
	
	"jbforth/events/050925-Gillians_Way/7343.htm" show
;

: bypass_event_050925_GW_7343-2
	1 step?
	"jbforth/events/050925-Gillians_Way/7343-2.htm" show
;

\ : on-npc-862-die   step? not if exit then   DeathLord-killed not if  true to DeathLord-killed then ;

: notify
	"Event begins!" announce
	"Event begins!" announce
	"Event begins!" announce
	s4
;

: 4296?   
	4296 player@ inventory? 1 < if rdrop exit then 
;

: on-npc-733-die 2 step?  4296?  1 5862 item_add ;
: on-npc-734-die 2 step?  4296?  1 5862 item_add ;
: on-npc-735-die 2 step?  4296?  1 5862 item_add ;
: on-npc-736-die 2 step?  4296?  1 5862 item_add ;
: on-npc-737-die 2 step?  4296?  1 5862 item_add ;

: npc-7518-dialog-append 
    2 step?
	'<br><a action="bypass -h jbf_event_050925_GW_7518">Event "Gillian’s Way"</a><br>' .
;

: bypass_event_050925_GW_7518
    2 step?

	4296 player@ inventory? 1 < if
		"Sorry, i don't know you" show
		exit
	then

	 5862 player@ inventory? 50 >= if
	 	5862 50 player@ inventory-!
		"jbforth/events/050925-Gillians_Way/7518-2.htm" show
		exit
	then
	
	 5862 player@ inventory? 0 > if
		'I need <font color="LEVEL">50</font> or more Stones of Contract!' show
		exit
	then

	"jbforth/events/050925-Gillians_Way/7518.htm" show
;

: npc-7525-dialog-append 
    3 step?
	'<br><a action="bypass -h jbf_event_050925_GW_7525">Event "Gillian’s Way"</a><br>' .
;

: bypass_event_050925_GW_7525
    3 step?
	4296 player@ inventory? 1 < if
		"Sorry, i don't know you" show
		exit
	then
	
	"7525-1st" uv-load dup if
		1 = if
			812 player@ inventory? 50 >= if
			 	812 50 player@ inventory-!
				2 "7525-1st" uv-save
				"jbforth/events/050925-Gillians_Way/7525-3.htm" show
				exit
			then
	
			'I need <font color="LEVEL">50</font> Adamantite Ore!' show
			exit
		then

		6363 player@ inventory? 50 >= if
		 	6363 50 player@ inventory-!
			"jbforth/events/050925-Gillians_Way/7525-4.htm" show
			2 ustep!
			exit
		then
	
		'I need <font color="LEVEL">50</font> Ore Stolen Infernum Ore!' show
		exit
	then
	
	drop
	
	
	1111 player@ inventory? 50 >= if
	 	1111 50 player@ inventory-!
		1 "7525-1st" uv-save
		"jbforth/events/050925-Gillians_Way/7525-2.htm" show
		exit
	then
	
	 1111 player@ inventory? 0 > if
		'I need <font color="LEVEL">50</font> Adamantite Ore!' show
		exit
	then

	"jbforth/events/050925-Gillians_Way/7525.htm" show
;

: on-npc-1032-die 3 step?  4296?  1 1111 item_add ;
: on-npc-1033-die 3 step?  4296?  1 1111 item_add ;

: on-npc-886-die 3 step?  4296?  1 812 item_add ;

: on-npc-881-die 3 step?  4296?  1 6363 item_add ;

: npc-7527-dialog-append 
    2 ustep? 4296?
	'<br><a action="bypass -h jbf_event_050925_GW_7527">Event "Gillian’s Way"</a><br>' .
;

: bypass_event_050925_GW_7527
    2 ustep? 4296?
	
	"Sorry, talk with me later..." show exit
	
	"jbforth/events/050925-Gillians_Way/7527.htm" show
;

: bypass_event_050925_GW_7527-2
    2 ustep? 4296?
	20000 adena_pay
	1 5559 item_add
	"jbforth/events/050925-Gillians_Way/7527-2.htm" show
;

: start
	ride-hair-disable
	run!
;

\ === teleporters ===
\ : npc-7588-dialog-append  step? not if exit then		'<br><a action="bypass -h jbf_event_theft-of-kamilla_7588">Event "Theft of lady Kamilla". Next point...</a><br>' . ;
\ : bypass_event_theft-of-kamilla_7588 79766 -15347 -276 jump ;
